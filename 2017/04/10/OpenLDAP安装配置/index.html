<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="UnixFBI 运维特工"><title>OpenLDAP安装配置 | UnixFBI 运维特工</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.3.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=1.3.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">OpenLDAP安装配置</h1><a id="logo" href="/.">UnixFBI 运维特工</a><p class="description">运维特工</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">OpenLDAP安装配置</h1><div class="post-meta">Apr 10, 2017<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>#OpenLDAP安装配置<br>[TOC]</p>
<p>##一、环境说明：<br><strong>系统版本：</strong>CentOS Linux release 7.2.1511 (Core)<br><strong>内核版本：</strong>3.10.0-327.el7.x86_64</p>
<p><strong>软件版本：</strong><br>openldap-servers-2.4.40-13.el7.x86_64<br>openldap-2.4.40-13.el7.x86_64<br>openldap-devel-2.4.40-13.el7.x86_64<br>compat-openldap-2.3.43-5.el7.x86_64<br>openldap-clients-2.4.40-13.el7.x86_64</p>
<p>##二、安装OpenLDAP</p>
<p>###1.安装OpenLDAP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># yum install -y nscd-pam-ldapd nss-* pcre pcre-* --skip-broken  </span></div><div class="line">如果需要运行用户本地查询LDAP服务，则需要安装以下依赖包</div><div class="line">nss-pam-ldapd</div><div class="line"><span class="comment"># yum install -y nscd-pam-ldapd nss-* pcre pcre-* --skip-broken</span></div></pre></td></tr></table></figure>
<p>##三、配置OpenLDAP</p>
<p>###1.配置文件说明</p>
<p>   在OpenLDAP2.4版本中，配置OpenLDAP的方法有两种：一种通过修改配置文件实现配置，另一种通过修改数据库的形式完成配置。<br>        当前仍然可以使用传统的配置文件（slapd.conf）方式进行配置，通过配置文件来实现slapd的配置方式，修改完配置后需要重启slapd进程才能使配置生效。通过配置数据库完成各种配置，属于动态配置且不需要重新启动slapd进程服务。<br>        OpenLDAP主配置文件为/etc/openldap/slapd.conf 。 此文件默认是不存在，需要复制安装OpenLDAP软件包安装所产生的配置文件模板并重命名为slapd.conf文件。<br>openldap 如果在centos 5.8系统上配置文件模板是 存在的，但是在centos7上面yum 安装完成后发现没有这个模板文件。<br>配置文件路径包括以下几个：<br>/etc/openldap/slapd.conf (OpenLDAP主配置文件，记录根域名称、管理员名称、密码、日志、权限等相关信息)<br>/var/lib/ldap/*  (OpenLDAP数据文件存储位置，可以根据需求进行调整。但为了保证数据的安全)<br>/usr/share/openldap-servers/slapd.conf.obsolete （模板配置文件）<br>/usr/share/openldap-servers/DB_CONFIG.example （模板数据库配置文件schema路径）<br>OpenLDAP监听的端口有以下连个：<br>默认监听端口：389 （明文数据传输）<br>加密监听端口：636 （密文数据传输）</p>
<p>###2.配置管理员密码和搜索后缀以及管理员dn路径<br>配置文件为：<br><code>/etc/openldap/slapd.conf</code><br>a.配置管理员密码：<br>配置文件中添加：<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attr">#slappasswd -s 123456</span> | sed -e <span class="string">"s#&#123;SSHA&#125;#rootpw\t&#123;SSHA&#125;#g"</span> </div><div class="line">rootpw  &#123;SSHA&#125;<span class="number">2</span>KibfupcWOb<span class="symbol">N2</span>lJKlotSgLb<span class="name">m5</span>xRK<span class="number">832</span>e</div></pre></td></tr></table></figure></p>
<p>把生成的这一行添加到配置文件中<br>b.指定要搜索的后缀<br>把suffix                “dc=my-domain,dc=com”   修改为：suffix          “dc=ruwe,dc=cn”<br>c.指定管理员dn路径，使用这个dn可以登录OpenLDAP服务器<br>把rootdn                “cn=Manager,dc=my-domain,dc=com”  修改为：rootdn          “cn=Admin,dc=ruwe,dc=cn”</p>
<p>快速配置命令：<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#slappasswd -s 123456 | sed -e <span class="string">"s#&#123;SSHA&#125;#rootpw\t&#123;SSHA&#125;#g"</span> &gt;&gt; slapd.conf</span></div><div class="line"><span class="meta"># sed -i <span class="string">'s#^rootdn.*"$#rootdn          "cn=Admin,dc=ruwe,dc=cn"#g'</span>  slapd.conf</span></div><div class="line"><span class="meta"># sed -i <span class="string">'s#^suffix.*"$#suffix          "dc=ruwe,dc=cn"#g'</span>  slapd.conf</span></div></pre></td></tr></table></figure></p>
<p>###3.配置日志及缓存参数<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">cat  &gt;&gt;/etc/openldap/slapd.conf &lt;&lt; <span class="literal">EOF</span></div><div class="line">#add   start  by  pangguoping  </div><div class="line">loglevel    <span class="number">296</span></div><div class="line">cachesize    <span class="number">1000</span></div><div class="line">checkpoint    <span class="number">2048</span> <span class="number">10</span></div><div class="line">#add end by pangguoping</div><div class="line"><span class="literal">EOF</span></div></pre></td></tr></table></figure></p>
<p>以上参数说明：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">loglevel  <span class="number">296</span> </div><div class="line"></div><div class="line">#设置日志级别，记录日志新方便调试。<span class="number">296</span>级别是有<span class="number">256</span>（日志连接/操作/结果）、<span class="number">32</span>（搜索过滤器处理）、<span class="number">8</span>（连接管理）累加的结果</div><div class="line"></div><div class="line">cachesize    <span class="number">1000</span></div><div class="line">#设置ldap可以缓存的记录数</div><div class="line">checkpoint    <span class="number">2048</span> <span class="number">10</span></div><div class="line">#ldap checkpoint  项可以设置把内存中的数据写回数据文件的操作，上面设置表示每达到<span class="number">2048</span>KB或者<span class="number">10</span>分钟执行一次checkpoint，即写入数据文件的操作。</div></pre></td></tr></table></figure></p>
<p>###4.查看最后生成的配置<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># egrep -v <span class="string">"^$|^.*#"</span> /etc/openldap/slapd.conf </span></div><div class="line">include         <span class="meta-keyword">/etc/</span>openldap<span class="meta-keyword">/schema/</span>corba.schema</div><div class="line">include         <span class="meta-keyword">/etc/</span>openldap<span class="meta-keyword">/schema/</span>core.schema</div><div class="line">include         <span class="meta-keyword">/etc/</span>openldap<span class="meta-keyword">/schema/</span>cosine.schema</div><div class="line">include         <span class="meta-keyword">/etc/</span>openldap<span class="meta-keyword">/schema/</span>duaconf.schema</div><div class="line">include         <span class="meta-keyword">/etc/</span>openldap<span class="meta-keyword">/schema/</span>dyngroup.schema</div><div class="line">include         <span class="meta-keyword">/etc/</span>openldap<span class="meta-keyword">/schema/</span>inetorgperson.schema</div><div class="line">include         <span class="meta-keyword">/etc/</span>openldap<span class="meta-keyword">/schema/</span>java.schema</div><div class="line">include         <span class="meta-keyword">/etc/</span>openldap<span class="meta-keyword">/schema/</span>misc.schema</div><div class="line">include         <span class="meta-keyword">/etc/</span>openldap<span class="meta-keyword">/schema/</span>nis.schema</div><div class="line">include         <span class="meta-keyword">/etc/</span>openldap<span class="meta-keyword">/schema/</span>openldap.schema</div><div class="line">include         <span class="meta-keyword">/etc/</span>openldap<span class="meta-keyword">/schema/</span>ppolicy.schema</div><div class="line">include         <span class="meta-keyword">/etc/</span>openldap<span class="meta-keyword">/schema/</span>collective.schema</div><div class="line">allow bind_v2</div><div class="line">pidfile         <span class="meta-keyword">/var/</span>run<span class="meta-keyword">/openldap/</span>slapd.pid</div><div class="line">argsfile        <span class="meta-keyword">/var/</span>run<span class="meta-keyword">/openldap/</span>slapd.args</div><div class="line">modulepath <span class="meta-keyword">/usr/</span>lib/openldap</div><div class="line">modulepath <span class="meta-keyword">/usr/</span>lib64/openldap</div><div class="line">TLSCACertificatePath <span class="meta-keyword">/etc/</span>openldap/certs</div><div class="line">TLSCertificateFile <span class="string">"\"OpenLDAP Server\""</span></div><div class="line">TLSCertificateKeyFile <span class="meta-keyword">/etc/</span>openldap<span class="meta-keyword">/certs/</span>password</div><div class="line">database        bdb</div><div class="line">suffix          <span class="string">"dc=ruwe,dc=cn"</span></div><div class="line">rootdn          <span class="string">"cn=Admin,dc=ruwe,dc=cn"</span></div><div class="line">directory       <span class="meta-keyword">/var/</span>lib/ldap</div><div class="line">index objectClass                       eq,pres</div><div class="line">index ou,cn,mail,surname,givenname      eq,pres,sub</div><div class="line">index uidNumber,gidNumber,loginShell    eq,pres</div><div class="line">index uid,memberUid                     eq,pres,sub</div><div class="line">index nisMapName,nisMapEntry            eq,pres,sub</div><div class="line">rootpw  &#123;SSHA&#125;<span class="number">2</span>KibfupcWObN2lJKlotSgLbm5xRK832e</div><div class="line">loglevel    <span class="number">296</span></div><div class="line">cachesize    <span class="number">1000</span></div><div class="line">checkpoint    <span class="number">2048</span> <span class="number">10</span></div></pre></td></tr></table></figure></p>
<p>###5.配置OpenLDAP数据库：</p>
<blockquote>
<p><strong>注意：</strong>slapd.conf中设定了OpenLDAP数据库格式为bdb,存储路径为/var/lib/ldap<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># rm -f <span class="regexp">/var/</span>lib<span class="regexp">/ldap/</span>*</div><div class="line"># cp <span class="regexp">/usr/</span>share<span class="regexp">/openldap-servers/</span>DB_CONFIG.example <span class="regexp">/var/</span>lib<span class="regexp">/ldap/</span>DB_CONFIG</div><div class="line"># ll <span class="regexp">/var/</span>lib<span class="regexp">/ldap/</span>    </div><div class="line"># chown ldap:ldap <span class="regexp">/var/</span>lib<span class="regexp">/ldap/</span>DB_CONFIG   </div><div class="line"># chown -R ldap.ldap <span class="regexp">/var/</span>lib<span class="regexp">/ldap</span></div></pre></td></tr></table></figure></p>
</blockquote>
<p>测试配置：<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># slaptest -u</span></div><div class="line">config <span class="built_in">file</span> testing succeeded</div></pre></td></tr></table></figure></p>
<p>启动：<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># systemctl start slapd.service</span></div></pre></td></tr></table></figure></p>
<p>检查：<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># ldapsearch -LLL -W -x -H ldap://etiantian.org -D <span class="string">"cn=Admin,dc=ruwe,dc=cn"</span> -b <span class="string">"dc=ruwe,dc=cn"</span> <span class="string">"(uid=*)"</span></span></div><div class="line">Enter LDAP Password: </div><div class="line">No such object (<span class="number">32</span>)     <span class="meta"># 出现这个表示配置成功</span></div></pre></td></tr></table></figure></p>
<p>###6.生成2.4配置：<br>首先删除旧配置<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># rm -rf  <span class="regexp">/etc/</span>openldap<span class="regexp">/slapd.d/</span>*</div></pre></td></tr></table></figure></p>
<p>生成新配置<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d/</span></div><div class="line">58c92fea bdb_monitor_db_open: monitoring disabled; configure<span class="built_in"> monitor </span>database to enable</div><div class="line">config file testing succeeded</div><div class="line"><span class="comment"># chown -R ldap.ldap /etc/openldap/slapd.d/</span></div></pre></td></tr></table></figure></p>
<p>###7.导入用户数据：</p>
<blockquote>
<p>导入用户的数据，前提是我提前创建好了这些数据文件，然后执行的导入操作，文件内容如下：<br>基础数据文件：<br><figure class="highlight ldif"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cat base.ldif </span></div><div class="line"><span class="attribute">dn</span>: dc=ruwe,dc=cn</div><div class="line"><span class="attribute">objectClass</span>: organization</div><div class="line"><span class="attribute">objectClass</span>: dcObject</div><div class="line"><span class="attribute">dc</span>: ruwe</div><div class="line"><span class="attribute">o</span>: ruwe</div><div class="line"></div><div class="line"><span class="attribute">dn</span>: ou=People,dc=ruwe,dc=cn</div><div class="line"><span class="attribute">objectClass</span>: organizationalUnit</div><div class="line"><span class="attribute">ou</span>: People</div><div class="line"></div><div class="line"><span class="attribute">dn</span>: ou=group,dc=ruwe,dc=cn</div><div class="line"><span class="attribute">objectClass</span>: organizationalUnit</div><div class="line"><span class="attribute">ou</span>: group</div><div class="line"></div><div class="line"><span class="attribute">dn</span>: cn=tech,ou=group,dc=ruwe,dc=cn</div><div class="line"><span class="attribute">objectClass</span>: posixGroup</div><div class="line"><span class="attribute">description:</span>: 5oqA5pyv6YOo</div><div class="line"><span class="attribute">gidNumber</span>: 10001</div><div class="line"><span class="attribute">cn</span>: tech</div></pre></td></tr></table></figure></p>
</blockquote>
<p>用户数据文件：<br><figure class="highlight ldif"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cat ruowei.ldif </span></div><div class="line"><span class="comment"># pangguoping</span></div><div class="line"><span class="attribute">dn</span>: uid=pangguoping,ou=People,dc=ruwe,dc=cn</div><div class="line"><span class="attribute">objectClass</span>: posixAccount</div><div class="line"><span class="attribute">objectClass</span>: inetOrgPerson</div><div class="line"><span class="attribute">objectClass</span>: organizationalPerson</div><div class="line"><span class="attribute">objectClass</span>: person</div><div class="line"><span class="attribute">homeDirectory</span>: /home/pangguoping</div><div class="line"><span class="attribute">loginShell</span>: /bin/bash</div><div class="line"><span class="attribute">uid</span>: pangguoping</div><div class="line"><span class="attribute">cn</span>: 庞国平 </div><div class="line"><span class="attribute">sn</span>: 庞</div><div class="line"><span class="attribute">givenName</span>: 国平 </div><div class="line"><span class="attribute">userPassword:</span>: e1NTSEF9RTBOVTg3ejhoYjU1dHR6MVpMcVBjeVRIQVcxcUJrMXc=</div><div class="line"><span class="attribute">uidNumber</span>: 10002</div><div class="line"><span class="attribute">gidNumber</span>: 10001</div><div class="line"><span class="attribute">mail</span>: panggp@ruwe.cn</div><div class="line"></div><div class="line"><span class="comment"># liuchao</span></div><div class="line"><span class="attribute">dn</span>: uid=liuchao,ou=People,dc=ruwe,dc=cn</div><div class="line"><span class="attribute">objectClass</span>: posixAccount</div><div class="line"><span class="attribute">objectClass</span>: inetOrgPerson</div><div class="line"><span class="attribute">objectClass</span>: organizationalPerson</div><div class="line"><span class="attribute">objectClass</span>: person</div><div class="line"><span class="attribute">homeDirectory</span>: /home/liuchao</div><div class="line"><span class="attribute">loginShell</span>: /bin/bash</div><div class="line"><span class="attribute">uid</span>: liuchao</div><div class="line"><span class="attribute">cn</span>: 刘超 </div><div class="line"><span class="attribute">sn</span>: 刘</div><div class="line"><span class="attribute">givenName</span>: 超</div><div class="line"><span class="attribute">userPassword:</span>: e1NTSEF9RTBOVTg3ejhoYjU1dHR6MVpMcVBjeVRIQVcxcUJrMXc=</div><div class="line"><span class="attribute">uidNumber</span>: 10003</div><div class="line"><span class="attribute">gidNumber</span>: 10001</div><div class="line"><span class="attribute">mail</span>: liuc@ruwe.cn</div><div class="line"></div><div class="line"><span class="comment"># zhaoyimin</span></div><div class="line"><span class="attribute">dn</span>: uid=zhaoyimin,ou=People,dc=ruwe,dc=cn</div><div class="line"><span class="attribute">objectClass</span>: posixAccount</div><div class="line"><span class="attribute">objectClass</span>: inetOrgPerson</div><div class="line"><span class="attribute">objectClass</span>: organizationalPerson</div><div class="line"><span class="attribute">objectClass</span>: person</div><div class="line"><span class="attribute">homeDirectory</span>: /home/zhaoyimin</div><div class="line"><span class="attribute">loginShell</span>: /bin/bash</div><div class="line"><span class="attribute">uid</span>: zhaoyimin</div><div class="line"><span class="attribute">cn</span>: 赵依民 </div><div class="line"><span class="attribute">sn</span>: 赵</div><div class="line"><span class="attribute">givenName</span>: 依民</div><div class="line"><span class="attribute">userPassword:</span>: e1NTSEF9RTBOVTg3ejhoYjU1dHR6MVpMcVBjeVRIQVcxcUJrMXc=</div><div class="line"><span class="attribute">uidNumber</span>: 10004</div><div class="line"><span class="attribute">gidNumber</span>: 10001</div><div class="line"><span class="attribute">mail</span>: zhaoym@ruwe.cn</div></pre></td></tr></table></figure></p>
<p>####a.导入基础数据<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># ldapadd -x -H ldap://ldap-server -D <span class="string">"cn=Admin,dc=ruwe,dc=cn"</span>  -W -f /etc/openldap/userdb/<span class="keyword">base.ldif </span> </div><div class="line"><span class="symbol">Enter</span> LDAP Password: </div><div class="line"><span class="keyword">adding </span>new <span class="meta">entry</span> <span class="string">"dc=ruwe,dc=cn"</span></div><div class="line"></div><div class="line"><span class="keyword">adding </span>new <span class="meta">entry</span> <span class="string">"ou=People,dc=ruwe,dc=cn"</span></div><div class="line"></div><div class="line"><span class="keyword">adding </span>new <span class="meta">entry</span> <span class="string">"ou=group,dc=ruwe,dc=cn"</span></div><div class="line"></div><div class="line"><span class="keyword">adding </span>new <span class="meta">entry</span> <span class="string">"cn=tech,ou=group,dc=ruwe,dc=cn"</span></div></pre></td></tr></table></figure></p>
<p>####b.导入用户数据<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># ldapadd -x -H ldap://ldap-server -D <span class="string">"cn=Admin,dc=ruwe,dc=cn"</span>  -W -f /etc/openldap/userdb/ruowei.ldif </div><div class="line">Enter LDAP Password: </div><div class="line"></div><div class="line">adding <span class="keyword">new</span> <span class="keyword">entry</span> <span class="string">"uid=pangguoping,ou=People,dc=ruwe,dc=cn"</span></div><div class="line"></div><div class="line">adding <span class="keyword">new</span> <span class="keyword">entry</span> <span class="string">"uid=liuchao,ou=People,dc=ruwe,dc=cn"</span></div></pre></td></tr></table></figure></p>
<p>####c.查询导入的数据：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># ldapsearch -LLL -W -x -H ldap://ldap-server -D &quot;cn=Admin,dc=ruwe,dc=cn&quot;  -b &quot;dc=ruwe,dc=cn&quot;</div></pre></td></tr></table></figure></p>
<p>##四、OpenLDAP管理工具LAM</p>
<blockquote>
<p><strong>OpenLDAP GUI</strong>管理有3种工具进行管理，例如：phpLDAPadmin，LAM，LDAP Aadmin ，今天我们以LAM为例进行演示</p>
<p>###1.安装相关软件<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># yum install httpd php php-ldap php-gd</span></div></pre></td></tr></table></figure></p>
</blockquote>
<p>软件包版本：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># <span class="selector-tag">rpm</span> <span class="selector-tag">-qa</span>  <span class="selector-tag">httpd</span> <span class="selector-tag">php</span>*</div><div class="line"><span class="selector-tag">php-gd-5</span><span class="selector-class">.4</span><span class="selector-class">.16-42</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span></div><div class="line"><span class="selector-tag">httpd-2</span><span class="selector-class">.4</span><span class="selector-class">.6-45</span><span class="selector-class">.el7</span><span class="selector-class">.centos</span><span class="selector-class">.x86_64</span></div><div class="line"><span class="selector-tag">php-common-5</span><span class="selector-class">.4</span><span class="selector-class">.16-42</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span></div><div class="line"><span class="selector-tag">php-5</span><span class="selector-class">.4</span><span class="selector-class">.16-42</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span></div><div class="line"><span class="selector-tag">php-cli-5</span><span class="selector-class">.4</span><span class="selector-class">.16-42</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span></div><div class="line"><span class="selector-tag">php-ldap-5</span><span class="selector-class">.4</span><span class="selector-class">.16-42</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span></div></pre></td></tr></table></figure></p>
<p>###2.安装LAM<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># tar zxf /usr/local/src/ldap-account-manager-3.7.tar.gz -C  /var/www/html/</span></div><div class="line"><span class="meta"># cd /var/www/html</span></div><div class="line"><span class="meta"># mv ldap-account-manager-3.7 ldap</span></div></pre></td></tr></table></figure></p>
<p>###3.配置LAM<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># cd ldap/config</span></div><div class="line"><span class="meta"># cp lam.conf_sample lam.conf</span></div><div class="line"><span class="meta"># sed -i 's#cn=Manager#cn=Admin#g' lam.conf</span></div><div class="line"><span class="meta"># sed -i 's#dc=my-domain#dc=ruwe#g' lam.conf</span></div><div class="line"><span class="meta"># sed -i 's#dc=yourdomain#dc=ruwe#g' lam.conf</span></div><div class="line"><span class="meta"># sed -i 's#dc=com#dc=cn#g' lam.conf</span></div><div class="line"><span class="meta"># cp config.cfg_sample  config.cfg</span></div><div class="line"></div><div class="line"><span class="meta"># chown -R apache.apache /var/www/html/</span></div></pre></td></tr></table></figure></p>
<p>###4.配置lam虚拟主机<br>创建文件：/etc/httpd/conf.d/lam.conf<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cat /etc/httpd/conf.d/lam.conf   </span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#  Web-based tool for managing LDAP servers</span></div><div class="line"><span class="comment">#</span></div><div class="line"></div><div class="line"><span class="attribute">Alias</span> /ldapadmin /var/www/html/ldap</div><div class="line"></div><div class="line"><span class="section">&lt;Directory /var/www/html/ldap&gt;</span></div><div class="line">  <span class="section">&lt;IfModule mod_authz_core.c&gt;</span></div><div class="line">    <span class="comment"># Apache 2.4</span></div><div class="line">    <span class="attribute">AllowOverride</span> <span class="literal">All</span></div><div class="line">    <span class="attribute">Require</span> <span class="literal">all</span> granted</div><div class="line">    </div><div class="line">  <span class="section">&lt;/IfModule&gt;</span></div><div class="line">  <span class="section">&lt;IfModule !mod_authz_core.c&gt;</span></div><div class="line">    <span class="comment"># Apache 2.2</span></div><div class="line">    <span class="attribute"><span class="nomarkup">order</span></span> Allow,deny</div><div class="line">    <span class="attribute"><span class="nomarkup">Deny</span></span> from <span class="literal">all</span></div><div class="line">    <span class="attribute"><span class="nomarkup">Allow</span></span> from <span class="literal">all</span></div><div class="line">    <span class="attribute"><span class="nomarkup">Allow</span></span> from 127.0.0.1</div><div class="line">    <span class="attribute"><span class="nomarkup">Allow</span></span> from ::1</div><div class="line">  <span class="section">&lt;/IfModule&gt;</span></div><div class="line"><span class="section">&lt;/Directory&gt;</span></div></pre></td></tr></table></figure></p>
<p>###5.启动httpd<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># systemctl start httpd.service</span></div><div class="line"><span class="meta"># systemctl status httpd.service</span></div></pre></td></tr></table></figure></p>
<p>###6.访问<br><a href="http://IP/ldapadmin" target="_blank" rel="external">http://IP/ldapadmin</a></p>
<p>###7.配置一个nginx反向代理<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cat ldapadmin.ruwe.cn.conf </span></div><div class="line"><span class="attribute">upstream</span> ldap-backend &#123;</div><div class="line">        <span class="attribute">server</span> <span class="number">127.0.0.1:8080</span> weight=<span class="number">1</span> max_fails=<span class="number">2</span> fail_timeout=<span class="number">30s</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="section">server</span> &#123;</div><div class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</div><div class="line">        <span class="attribute">server_name</span> ldapadmin.ruwe.cn;</div><div class="line">        <span class="attribute">access_log</span> /var/log/nginx/ldapadmin.ruwe.cn.access.log main;</div><div class="line">        <span class="attribute">index</span> index.html index.php index.html;</div><div class="line">        <span class="attribute">root</span> /var/www/html/ldap/;</div><div class="line">        <span class="attribute">allow</span> <span class="number">124.202.245.170</span>;</div><div class="line">        <span class="attribute">allow</span> <span class="number">124.207.215.82</span>;</div><div class="line">        <span class="attribute">deny</span> all;</div><div class="line">        <span class="attribute">location</span> =/ &#123;</div><div class="line">                <span class="attribute">rewrite</span><span class="regexp"> ^/</span>  /ldapadmin <span class="literal">last</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="attribute">location</span> = /update_passwd.php &#123;</div><div class="line">                 <span class="attribute">rewrite</span><span class="regexp"> ^/update_passwd.php</span>  /ldapadmin/update_passwd.php <span class="literal">last</span>;  </div><div class="line"></div><div class="line">        &#125;</div><div class="line">        <span class="attribute">location</span> /ldapadmin &#123;</div><div class="line">                <span class="attribute">proxy_pass</span> http://ldap-backend;</div><div class="line">        </div><div class="line">        &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>配置完成nginx反向代理后，在DNS做域名解析，然后就可以直接用域名访问了。</p>
<p>好了，OpenLDAP 和 LAM 已经安装配置完成。谢谢</p>
</div><div class="tags"><a href="/tags/OpenLDAP/">OpenLDAP</a></div><div class="post-nav"><a href="/2017/04/10/nginx/" class="pre">nginx</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="widget"><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="请输入关键字..."/></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/OpenLDAP/" style="font-size: 15px;">OpenLDAP</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-fei"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/04/10/OpenLDAP安装配置/">OpenLDAP安装配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/10/nginx/">nginx</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/08/hello-world/">Hello World</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.3.0" async></script><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |<a href="/atom.xml">订阅本站</a> |<span>联系博主：<a href="mailto:null" target="_blank" class="fa fa-email"> </a><a href="null" target="_blank" class="fa fa-weibo"></a><a href="null" target="_blank" class="fa fa-github"> </a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">UnixFBI</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span><span><a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> Theme </a>by<a rel="nofollow" target="_blank" href="https://github.com/chaooo"> Charles.</a></span></p></div></div></div><script type="text/javascript" src="/js/search.json.js?v=1.3.0"></script></body></html>